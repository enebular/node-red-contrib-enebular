<script type="text/x-red" data-template-name="TSL2561">
  <div class="form-row">
      <label for=""><i class="fa fa-microchip"></i> Board</label>
      <select id="node-input-board" type="text">
        <option value="">select deploy board ...</option>
        <option value="RAVEN">RAVEN</option>
        <option value="SBB">SBB</option>
      </select>
      <input type="hidden" id="node-input-scl">
      <input type="hidden" id="node-input-sda">
      <input type="hidden" id="node-input-addr">
  </div>
  <div class="form-row raven hidden" id="port-name-raven">
    <label for="node-input-scl"><i class="fa fa-bolt"></i> Port</label>
      <select type="text" id="raven-port">
        <option value="GRV1">PORT1</option>
        <option value="GRV2">PORT2</option>
      </select>
  </div>
    <div class="form-row">
      <label for="node-input-integralTime"><i class="fa fa-cogs"></i> Integral Time</label>
      <select type="text" id="node-input-integralTime">
        <option value="_13MS">13ms</option>
        <option value="_101MS">101ms</option>
        <option value="_402MS">402ms</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-gain"><i class="fa fa-cogs"></i> Gain</label>
      <select type="text" id="node-input-gain">
        <option value="_1X">1x</option>
        <option value="_16X">16x</option>
      </select>
    </div>
    <div class="form-row hidden">
      <label for="node-input-spectrum"><i class="fa fa-cogs"></i> Spectrum</label>
      <select type="text" id="node-input-spectrum">
        <option value="FULLSPECTRUM">Full Spectum</option>
        <option value="INFRARED">Infrared</option>
        <option value="VISIBLE">Visible</option>
      </select>
    </div>    
    <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>

</script>

<script type="text/javascript">
  RED.nodes.registerType('TSL2561', {
    category: 'EEA',
    color: '#91b122',
    defaults: {
      board: { value: '' },
      scl: { value: '' },
      sda: { value: '' },
      addr: { value: '' },
      integralTime: { value: '_101MS' },
      gain: { value: '_1X' },
      spectrum: { value: 'VISIBLE' },
      name: { value: '' }
    },
    inputs: 1,
    outputs: 1,
    icon: 'i2c.png',
    label: function () {
      return this.name || 'TSL2561';
    },
    oneditprepare: function () {
      $("#node-input-board").change(function () {
        var _board = $("#node-input-board").val();
        if (_board == "RAVEN") {
          $("#port-name-raven").show();
          if($("#node-input-scl").val() === "GRV21"){
            $("#raven-port").val("GRV2");
          }else if($("#node-input-scl").val() === "GRV11"){
            $("#raven-port").val("GRV1");
          }
        } else {
          $("#port-name-raven").hide();
        }
      })
    },
    oneditsave: function () {
      var _board = $("#node-input-board").val();
      if (_board == "SBB") {
        $("#node-input-addr").val("LOW");
        $("#node-input-scl").val("PTE24");
        $("#node-input-sda").val("PTE25");
      } else if (_board == "RAVEN") {
        var port = $("#raven-port").val();
        $("#node-input-addr").val("LOW");
        if (port == "GRV2") {
          $("#node-input-scl").val("GRV21");
          $("#node-input-sda").val("GRV22");
        } else if (port == "GRV1") {
          $("#node-input-scl").val("GRV11");
          $("#node-input-sda").val("GRV12");
        }
        $("#raven-port").val(port);
      } else {
        $("#node-input-scl").val("");
        $("#node-input-sda").val("");
        $("#node-input-addr").val("");
      }
    }
  });
</script>

<script type="text/x-red" data-help-name="TSL2561">

  <p>Get value read by TSL2561. It is able to measure luminosity. This node is for enebular-edge-agent.</p>
    
  <h3>Outputs</h3>
  <dl class="message-properties">
      <dt>payload<span class="property-type">number</span></dt>
      <dd>The unit is lx.</dd>
  </dl>

  <h3>Details</h3>
    
  <h4>Setting items</h4>
  <ul>
    <li><code>Board</code>： Target board.*1</li>
    <li><code>Port</code>： Target port.*1</li>
    <li><code>Integral Time</code>： Measurement integration time. </li>
    <li><code>Gain</code>： Amplification value.</li>
    <!--<li><code>Spectrum</code>： Type of light to be measured.</li>-->
  </ul>
  <p>*1 See below about <code>Board</code> and <code>Port</code>.</p>

  <h4>Operation on flow editor</h4>
  <p>On flow editor, the nodes for enebular-edge-agent doesn't output value read by module but dummy value on flow editor.</p>
  <p>Output format of the value is equal to on the module. So, able to edit flow by using dummy value.</p>
  <p>In this node, <code>msg.payload</code> is fixed value(<code>50</code>). </p>

  <h4>About enebular-edge-agent</h4>

  <p>enebular-edge-agent operates on RAVEN and SBB. Please refer to the following to set the board pin assignment. Deploying settings of different boards Flow is not executed.</p>
  
  <h5>RAVEN</h5>
  <img src="icons/node-red-contrib-enebular/eea_fig_v2.png">
  
  <h5>SBB</h5>
  <img src="icons/node-red-contrib-enebular/eea_fig_v1.png">

</script>