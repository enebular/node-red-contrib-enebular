<script type="text/x-red" data-template-name="analogin">
  <div class="form-row">
    <label for=""><i class="fa fa-microchip"></i> Board</label>
    <select id="node-input-board" type="text">
        <option value="">select deploy board ...</option>
        <option value="RAVEN">RAVEN</option>
      <option value="SBB">SBB</option>
    </select>
    <input type="hidden" id="node-input-pin">
  </div>
    <div class="form-row sbb hidden" id="pin-name-sbb">
      <label for=""><i class="fa fa-bolt"></i> Pin</label>
      <select type="text" id="sbb-pin">
        <option value="A4">GRV - SIG1</option>
        <option value="A5">GRV - SIG2</option>
      </select>

    </div>
    <div class="form-row raven hidden" id="pin-name-raven">
      <label for=""><i class="fa fa-bolt"></i> Pin</label>
      <select type="text" id="raven-pin">
        <option value="GRV31">PORT3 - SIG1</option>
        <option value="GRV32">PORT3 - SIG2</option>
        <option value="GRV41">PORT4 - SIG1</option>
        <option value="GRV42">PORT4 - SIG2</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-vt"><i class="fa fa-sign-out"></i> Value Type</label>
      <select type="text" id="node-input-vt">
        <option value="int">int</option>
        <option value="float">float</option>
        <option value="voltage">voltage</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
  RED.nodes.registerType('analogin', {
    category: 'EEA',
    color: '#91b122',
    defaults: {
      board: { value: '' },
      pin: { value: '' },
      vt: { value: 'int' },
      name: { value: '' }
    },
    inputs: 1,
    outputs: 1,
    icon: 'analog.png',
    label: function () {
      return this.name || 'analogin';
    },
    oneditprepare: function () {
      $("#node-input-board").change(function () {
        var _board = $("#node-input-board").val();
        if (_board == "SBB") {
          $("#pin-name-raven").hide();
          $("#pin-name-sbb").show();
        } else if (_board == "RAVEN") {
          $("#pin-name-sbb").hide();
          $("#pin-name-raven").show();
        } else {
          $("#pin-name-sbb").hide();
          $("#pin-name-raven").hide();
        }
      })
      $("#sbb-pin").val($("#node-input-pin").val());
      $("#raven-pin").val($("#node-input-pin").val());
    },
    oneditsave: function () {
      var _board = $("#node-input-board").val();
      if (_board == "SBB") {
        $("#node-input-pin").val($("#sbb-pin").val());
      } else if (_board == "RAVEN") {
        $("#node-input-pin").val($("#raven-pin").val());
      } else {
        $("#node-input-pin").val('');
      }
    }
  });
</script>

<script type="text/x-red" data-help-name="analogin">

  <p> Get value read by Analog-to-Digital Converter. This node is for enebular-edge-agent. </p>

  <h3>Outputs</h3>
  <dl class="message-properties">
      <dt>payload<span class="property-type">number</span></dt>
      <dd>The value read by ADC.</dd>
      <dt>analogin<span class="property-type">number</span></dt>
      <dd>The value read by ADC. * equal to value of payload.</dd>
      <dt class="optional">topic <span class="property-type">string</span></dt>
      <dd>A pin name configured in the node. * This name is controlled by micro board. So it is different from node config value.</dd>
  </dl>

  <h3>Details</h3>
  
  <h4>Setting items</h4>
    <ul>
      <li><code>Board</code>： Target board.*1</li>
      <li><code>Pin</code>： Target pin.*1</li>
      <li><code>Value</code>: Output format of value read by ADC.</li>
      <ul>
        <li><code>int</code>: Value range is 0 - 65535 </li>
        <li><code>float</code>: Value range is 0.0000 - 1.0000 </li>
        <li><code>voltage</code>: Value range is 0.0000 - 3.3000 </li>
      </ul>
    </ul>
    <p>*1 See below about <code>Board</code> and <code>Pin</code>.</p>

  <h4>Operation on flow editor</h4>
  <p>On flow editor, the nodes for enebular-edge-agent doesn't output value read by module but dummy value on flow editor.</p>
  <p>Output format of the value is equal to on the module. So, able to edit flow by using dummy value.</p>
  <p>In this node, <code>msg.payload</code> and <code>msg.analogin</code> are fixed value. The value is changed by <code>valueType</code>.</p>
  <ul>
    <li>int : 65535</li>
    <li>float : 1</li>
  <li>voltage : 3.3</li>
  </ul>

  <h4>About enebular-edge-agent</h4>

  <p>enebular-edge-agent operates on RAVEN and SBB. Please refer to the following to set the board pin assignment. Deploying settings of different boards Flow is not executed.</p>
  
  <h5>RAVEN</h5>
  <img src = "icons/node-red-contrib-enebular/eea_fig_v2.png">
  
  <h5>SBB</h5>
  <img src = "icons/node-red-contrib-enebular/eea_fig_v1.png">
</script>